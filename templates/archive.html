<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Storyboard-AI - Your personal storyteller, animator, reader, designer, producer, and narrator.">
  <meta name="author" content="Andrea Filiberto Lucas & Sean David Muscat">
  <meta name="robots" content="index, follow">

  <!-- Open Graph Meta Tags for Social Media -->
  <meta property="og:title" content="Storyboard-AI - Your Personal Storyteller">
  <meta property="og:description" content="Storyboard-AI creates personalized stories with animation, narration, and design tailored to you.">
  <meta property="og:image" content="{{ url_for('serve_assets', filename='img/hero-bg.jpg') }}">
  <meta property="og:type" content="website">
  <title>Archive - Storyboard-AI</title>

  <!-- Favicons -->
  <link id="favicon" rel="icon" href="{{ url_for('serve_assets', filename='img/faviconSB.png') }}" 
    data-light-icon="{{ url_for('serve_assets', filename='img/faviconSB.png') }}" 
    data-dark-icon="{{ url_for('serve_assets', filename='img/faviconSBDark.png') }}">

  <link id="apple-touch-icon" rel="apple-touch-icon" href="{{ url_for('serve_assets', filename='img/faviconSB.png') }}" 
    data-light-icon="{{ url_for('serve_assets', filename='img/faviconSB.png') }}" 
    data-dark-icon="{{ url_for('serve_assets', filename='img/faviconSBDark.png') }}">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&family=Poppins:wght@100;200;300;400;500;600;700;800;900&family=Raleway:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="{{ url_for('serve_assets', filename='vendor/bootstrap-icons/bootstrap-icons.css') }}" rel="stylesheet">
  <link href="{{ url_for('serve_assets', filename='vendor/bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">
  <link href="{{ url_for('serve_assets', filename='vendor/glightbox/css/glightbox.min.css') }}" rel="stylesheet">
  <link href="{{ url_for('serve_assets', filename='vendor/aos/aos.css') }}" rel="stylesheet">
  <link href="{{ url_for('serve_assets', filename='vendor/swiper/swiper-bundle.min.css') }}" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="{{ url_for('serve_assets', filename='css/main.css') }}" rel="stylesheet">

  <!-- Include pdfmake library for PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.69/pdfmake.min.js"></script>
  <!-- Include vfs_fonts.js, required for handling embedded fonts in pdfmake -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.69/vfs_fonts.js"></script>
</head>

<body class="index-page">
    <!-- Header Section -->
    <header id="header" class="header d-flex flex-column justify-content-center" role="banner">
      <i class="header-toggle d-xl-none bi bi-list" aria-label="Toggle navigation menu"></i>
      <nav id="navmenu" class="navmenu" role="navigation">
        <ul>
          <li><a href="/home"><i class="bi bi-house navicon"></i><span>Home</span></a></li>
          <li><a href="/profile"><i class="bi bi-person navicon"></i><span>Profile</span></a></li>
          <li><a href="/chat"><i class="bi bi-chat-left-dots"></i><span>Chat</span></a></li>
          <li><a href="" class="active" aria-current="page"><i class="bi bi-clock-history"></i><span>Archive</span></a></li>
          <li><a href="#" id="signout-btn"><i class="bi bi-box-arrow-right"></i><span>Signout</span></a></li>
        </ul>
      </nav>
    </header>
  
    <main class="main">
      <!-- Hero Section -->
      <section id="hero" class="hero section light-background" aria-labelledby="hero-title">
          <img src="{{ url_for('serve_assets', filename='img/hero-archive-bg.jpg') }}" alt="Storyboard-AI Background Image" class="hero-bg">
          <div class="container" data-aos="zoom-out">
              <div class="row">
                  <div class="col-12">
                      <h2 id="hero-title" class="position-relative" style="margin-bottom: 125px; position: fixed;">
                          <!-- Button in Top Right Corner -->
                          <a href="/chat" id="new-story-button" class="position-absolute top-0 end-0 m-4" style="z-index: 5;">
                              <i style= "padding-right: 3px;"class="bi bi-plus-circle"></i> Create New Story
                          </a>                            
                          <!-- Text on Top Left, aligned with the button -->
                          <div class="position-absolute top-0 start-0 m-4" style="z-index: 5;">
                              <p class="Archive-Title">Your Story Archive</p>
                          </div>
                      </h2>
                      <!-- Card Container -->
                      <div class="card chatbox_2">
                          <div id="container-101" class="d-flex flex-column align-items-center justify-content-center" style="width: 100%; height: auto;">
                              <!-- Search Bar -->
                              <div class="input-group mb-3" style="width: 80%; max-width: 500px; position: relative;">
                                  <input type="text" id="search-bar" placeholder="Search your stories..." class="form-control" style="padding-left: 40px;" />
                                  <i class="bi bi-search" style="position: absolute; top: 50%; left: 15px; transform: translateY(-50%); pointer-events: none; z-index: 999;"></i>
                              </div>               
                              <!-- This paragraph will dynamically show the number of previous chats -->
                              <p id="story-count" class="mb-3 text-center" style="font-size: 20px; color: rgb(52 98 143); width: 80%; max-width: 800px; padding-left: 0; padding-top: 5px;"></p>
                          </div>
                          <!-- Section to display story titles -->
                          <div id="story-cards-container" class="d-flex flex-column align-items-center overflow-auto" style="height: calc(72vh - 100px); width: 100%;">
                              <!-- Story cards will be appended here dynamically -->
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </section>
  </main>
  
</body>
  
  <!-- Footer Section -->
  <footer id="footer" class="footer position-relative light-background" role="contentinfo">
    <div class="credits">
      Designed by <a href="mailto:andrea.f.lucas.22@um.edu.mt" target="_blank" style="font-size: 15px;">Andrea Filiberto Lucas</a>
      & <a href="mailto:sean.muscat.22@um.edu.mt" target="_blank" style="font-size: 15px;">Sean David Muscat</a>
    </div>
    <div class="credits">
      Template from <a href="https://bootstrapmade.com/" style="font-size: 14px;">Bootstrap</a>
    </div>
  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center" aria-label="Scroll to top"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="{{ url_for('serve_assets', filename='vendor/bootstrap/js/bootstrap.bundle.min.js') }}" defer></script>
  <script src="{{ url_for('serve_assets', filename='vendor/php-email-form/validate.js') }}" defer></script>
  <script src="{{ url_for('serve_assets', filename='vendor/aos/aos.js') }}" defer></script>
  <script src="{{ url_for('serve_assets', filename='vendor/typed.js/typed.umd.js') }}" defer></script>
  <script src="{{ url_for('serve_assets', filename='vendor/purecounter/purecounter_vanilla.js') }}" defer></script>
  <script src="{{ url_for('serve_assets', filename='vendor/waypoints/noframework.waypoints.js') }}" defer></script>
  <script src="{{ url_for('serve_assets', filename='vendor/glightbox/js/glightbox.min.js') }}" defer></script>
  <script src="{{ url_for('serve_assets', filename='vendor/imagesloaded/imagesloaded.pkgd.min.js') }}" defer></script>
  <script src="{{ url_for('serve_assets', filename='vendor/isotope-layout/isotope.pkgd.min.js') }}" defer></script>
  <script src="{{ url_for('serve_assets', filename='vendor/swiper/swiper-bundle.min.js') }}" defer></script>

  <!-- Main JS File -->
  <script src="{{ url_for('serve_assets', filename='js/main.js') }}" defer></script>
  <script src="{{ url_for('serve_assets', filename='js/archive.js') }}" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Script to Display Current User -->
  <script>
  window.onload = function() {
    // Retrieve the username (assumed to be the full name) from localStorage
    const currentUser = localStorage.getItem('currentuser');

    // Extract the first name (assuming the first word is the first name)
    const firstName = currentUser ? currentUser.split(' ')[0] : 'User';  // Default to 'User' if no name is found

    // Update the Archive-Title text
    const archiveTitleElement = document.querySelector('.Archive-Title');
    archiveTitleElement.textContent = `${firstName}'s Story Archive`;

    // Signout functionality
    document.getElementById('signout-btn').addEventListener('click', function(e) {
      e.preventDefault();  // Prevent default anchor behavior (scrolling)
      
      // Remove the user from localStorage
      localStorage.removeItem('currentuser');

      // Clear cookies
      clearCookies();

      // Clear user info from the UI
      document.getElementById('current-user-name').textContent = 'User'; // Reset the displayed username

      // Send request to server to clear HttpOnly cookies
      fetch('/clear-cookies', { method: 'POST' })
        .then(response => {
          if (response.ok) {
            console.log('Server-side cookies cleared');
          }
        });

      // Redirect to the homepage or login page after sign-out
      window.location.href = "/";  // Adjust the URL to your desired redirection path (e.g., homepage or login page)
    });
  };

  // Function to clear cookies accessible via JavaScript
  function clearCookies() {
    const cookieNames = ["email", "name", "session"];
    
    cookieNames.forEach(cookieName => {
      document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; domain=${window.location.hostname};`;
      document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; domain=.${window.location.hostname};`;
      document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; domain=${window.location.hostname}; secure;`;
      document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; domain=.${window.location.hostname}; secure;`;
    });

    // Clear all other cookies
    const cookies = document.cookie.split(";");
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i];
      const eqPos = cookie.indexOf("=");
      const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();
      
      document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; domain=${window.location.hostname};`;
      document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; domain=.${window.location.hostname};`; // For subdomains
    }
  }
  </script>  
</body>
</html>